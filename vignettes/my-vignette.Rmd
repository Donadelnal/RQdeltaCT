---
title: "RQdeltaCT - relative quantification of gene expression using delta Ct methods"
output: rmarkdown::html_vignette
author: "Daniel Zalewski"
date: "5 February 2024"
vignette: >
  %\VignetteIndexEntry{RQdeltaCT - relative quantification of gene expression using delta Ct methods}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

### Short description
`RQdeltaCT` is a R packege designed to perform relative quantification of gene expression using delta Ct methods, proposed by Kenneth J. Livak and Thomas D. Schmittgen  [Article1](https://www.sciencedirect.com/science/article/pii/S1046202301912629?via%3Dihub) [Article2](https://www.nature.com/articles/nprot.2008.73).

These methods are adapted to analyze gene expression data (Ct values) obtained from real-time PCR experiments, and allow to normalize gene expression values and compare them between groups of samples.

The main idea is to calculate differences in gene expression levels between groups of samples (or technical replicates of one sample) and present obtained differences in linear form by using 2^-(value)^ transformation.  

There are several delta Ct methods of relative quantification, depending on the study design. Below short description of these methods are provided, for more details refer to articles from links above.

1. 2^-Ct^ method. Could be used in scenario where several genes are tested if are suitable to be used as reference genes (if are influenced by studied experiment condition). Obtained Ct values are transformed using 2^-Ct^ formula, summarized by means in compared study conditions, and a ratio of means (fold change) is calculated for experimental condition.

2. 2^-dCt^ method. In this method, Ct values are normalized by endogenous control gene (often GAPDH, beta-actin, or other) by subtracting Ct value of engogenous control in sample from Ct value of target gene in the same sample, obtaining delta Ct (dCt) value. Subsequently, dCt values are transformed using 2^-dCt^ formula, summarized by means in compared study groups, and a ratio of means (fold change) is calculated for a study group. This method is useful where a compared groups contain biological replicates, ex. patients vs. healthy controls.  

3. 2^-ddCt^ method. similarly to 2^-dCt^ method, Ct values are normalized by endogenous control gene, but obtained delta Ct (dCt) values are not exponentially transformed, but summarized by means in compared study groups, and mean dCt in control group is subtracted from mean dCt in a study group, giving delta delta Ct (ddCt value). Subsequently, ddCt values are transformed using 2^-ddCt^ formula to obtain fold change value. This method is useful where a compared groups contain technical replicates, ex. samples of cell line before adding stimulant vs. samples of cell line after stimulation.

Presented `RQdeltaCT` package includes functions that encompass all of these methods. Selection of proper for analysis is up to the user.  

Functions developed within `RQdeltaCT` packages are designed to be maximally easy to use, even for the users who are beginners to R. The parameters of functions were prepared to sufficiently ranged all essential actions, and no additional, extensive coding steps are necessary in standard analysis. The package was developed in the intention to make an opportunity to use `RQdeltaCT` by no experts in R programming.

### Data import
Data analyzed with `RQdeltaCT` package should be in tabular form and contain the following information: group names, sample names, target names and Ct values. Flag information could be also added for data filtering purpose. Any other information could exist in data (user do not have to remove them), but will not be imported and analyzed.  

For user convenience, `RQdeltaCT` package provides two functions (read_Ct_long and read_Ct_wide) useful to import tables in .txt format, either in long-format structure (each information in columns):





or wide-format columns (samples by columns, targets by rows), respectively. However, the users could import data by their own code, but the final object should contain table with column named "Sample" with sample names, column named "Target" with target names, column named "Ct" with raw Ct values, column named "Group" with group names, and optionally column named "Flag" with flag information (should be class of character or factor).

#### Reading data using `read_Ct_long()` function.

In the following example, a `read_Ct_long()` function will be used to import long-format .txt table (data_Ct_long.txt) from `RQdeltaCt` package directory:

```{r eval=TRUE}
# Set path to file:
path <- system.file("extdata", "data_Ct_long.txt", package = "RQdeltaCT")

# Import file using path, values separator, decimal character and number of necessary columns:
library(RQdeltaCT)
library(tidyverse)
data.Ct <- read_Ct_long(path = path, sep = "\t",dec = ".",skip = 0,
                         add.column.Flag = TRUE, column.Sample = 1, column.Target = 2,
                         column.Ct = 5, column.Group = 9, column.Flag = 4)

```
Let's look at the data structure:
```{r eval=TRUE}
str(data.Ct)
```


The Flag column contains AmpScore parameter, which is typically used to evaluate amplification curve (curves with AmpScore below 1 are considered as low quality) and data filtering. This variable is of class numeric, therefore, additional transformation of this variable is necessary:

```{r}
library(tidyverse)
data.Ct <- mutate(data.Ct, Flag = ifelse(Flag < 1, "Undetermined", "OK"))
str(data.Ct)
```

In Flag column, all values below were changed to "Undetermined", while other values were changed to "OK". Flag variable now is of class character, as required.

#### Reading data using `read_Ct_wide()` function.

A `read_Ct_wide()` function was designed to import data in wide-format, containing sample names in the first row, and target names in first column. Such a structure do not icludes names of groups, thus another file with groups names and assigned samples is required. This second file must contain two columns: column named "Sample" with names of samples and column named "Group" with names of groups assigned to samples. Names of samples in this file should correspond to the names of columns in file with Ct values.

In this example, `read_Ct_wide()` function was used to import file with Ct values (data_Ct_wide.txt) and file with names of groups (data_design.txt) from `RQdeltaCt` package directory:

```{r eval=FALSE, include=FALSE}
# Import long-format table using 
library(RQdeltaCT)
path.Ct.file <- system.file("extdata", "data_Ct_wide.txt", package = "RQdeltaCT")
path.design.file <- system.file("extdata", "data_design.txt", package = "RQdeltaCT")
library(tidyverse)
data.Ct <- read_Ct_wide(path.Ct.file = path.Ct.file,
                    path.design.file = path.design.file,
                    sep ="\t",
                    dec = ".")
 str(data.Ct)

```







